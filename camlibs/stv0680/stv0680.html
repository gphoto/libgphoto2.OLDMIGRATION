<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.77C-CCK-MCD Caldera Systems OpenLinux [en] (X11; U; Linux 2.4.13-ac7 i686) [Netscape]">
</head>
<body>
This is brief protocol description of the STV 680 chip.
<p>It has been gleaned from work:
<ul>
<li>
Bart Hartger &lt;bart@etpmod.phys.tue.nl>&nbsp; (original investigations)</li>

<li>
Adam Harrison &lt;adam@antispin.org>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(gphoto2 driver)</li>

<li>
Marcus Meissner &lt;marcus@jet.frankende>&nbsp; (more investigations, information
cleanup)</li>
</ul>

<p><br>The camera has just 1 USB Endpoint (Bulk, 0x82) over which all data
is being read.
<br>It is controlled by sending USB control messages.
<br>&nbsp;
<br>&nbsp;
<table BORDER COLS=4 WIDTH="100%" NOSAVE >
<tr>
<td>Code</td>

<td>Arguments</td>

<td>Return Value</td>

<td>Description</td>
</tr>

<tr>
<td>0x00</td>

<td>0</td>

<td>0</td>

<td>No op?</td>
</tr>

<tr>
<td>0x04</td>

<td>none</td>

<td>none</td>

<td>Stops current operation.</td>
</tr>

<tr>
<td>0x06</td>

<td>0x100?
<br>(descriptor?)</td>

<td>18 byte</td>

<td>Unclear.
<br>Is sent to interface 0.</td>
</tr>

<tr>
<td>0x07</td>

<td>argument 0x100
<br>8 byte datapacket
<br>b[0] - new mode (see 0x87)</td>

<td>8 byte</td>

<td>Set Current Mode</td>
</tr>

<tr>
<td>0x09</td>

<td>image mode
<br>0x100 - VGA
<br>0x000 - CIF
<br>0x200 - QCIF
<br>0x300 - QVGA
<br>(can be ored by 0x8000)</td>

<td>read bytes respective for image</td>

<td>Capture Image</td>
</tr>

<tr>
<td>0x12</td>

<td>16 byte datapacket
<br>no argument</td>

<td>16 byte datapacket</td>

<td>Something with Exposure Packet.</td>
</tr>

<tr>
<td>0x13</td>

<td>0x000
<br>0x100
<br>0x200</td>

<td>none</td>

<td>Set Sensor Rate?</td>
</tr>

<tr>
<td>0x14</td>

<td>0x0 - disable 50hz banding&nbsp;
<br>0x100 - enable 50hz banding</td>

<td>none</td>

<td>Enable/Disable 50Hz Banding Filter.</td>
</tr>

<tr>
<td>0x80</td>

<td>none</td>

<td>2 byte
<br>b[0] - last error
<br>b[1] - command</td>

<td>Get Errorcode.</td>
</tr>

<tr>
<td>0x83</td>

<td>Image number</td>

<td>16 byte
<p>Width is b[4..5] MSB
<br>Height is b[6..7] MSB</td>

<td>Get Image</td>
</tr>

<tr>
<td>0x84</td>

<td>Image Number</td>

<td>16 byte
<p>Width is b[4..5] MSB
<br>Height is b[6..7] MSB</td>

<td>Get Preview</td>
</tr>

<tr>
<td>0x85</td>

<td>none</td>

<td>16 byte
<br>b[0] - Firmware Version High
<br>b[1] - Firmware Version Low
<br>b[2] - ASIC rev High
<br>b[3] - ASIC rev Low
<br>b[4] - Sensor ID High
<br>b[5] - Sensor ID Low
<br>b[6] - Flags
<blockquote>0x20 - camera busy?
<br>0x2 - 50 hz banding filter?</blockquote>
b[7] - supported modes bitmask
<blockquote>1 - CIF
<br>2 - VGA
<br>4 - QCIF
<br>8 - QVGA</blockquote>
</td>

<td>Get Camera Information</td>
</tr>

<tr>
<td>0x86</td>

<td>none</td>

<td>16 byte
<br>Images is b[0..1] MSB&nbsp;</td>

<td>Get File Info?</td>
</tr>

<tr>
<td>0x87</td>

<td>none</td>

<td>8 byte
<br>b[0] - current mode</td>

<td>Get Current Mode?</td>
</tr>

<tr>
<td>0x88</td>

<td>any</td>

<td>2 byte
<br>argument is returned, MSB first.</td>

<td>Ping</td>
</tr>

<tr>
<td>0x8a</td>

<td>none</td>

<td>2 byte
<br>Version of the Camera?
<br>b[0] high version
<br>b[1] low version</td>

<td>Camera Version. Shortcut of 0x85 for apparently newer camera versions.</td>
</tr>

<tr>
<td>0x8b</td>

<td>none?</td>

<td>36 byte, 3x3 ints</td>

<td>User Matrix. Whatever this means.
<p>Only works for firmware version 3 or later.</td>
</tr>

<tr>
<td>0x8c</td>

<td>none</td>

<td>1 byte
<br>set bit equals button pressed</td>

<td>Get Button State</td>
</tr>

<tr>
<td>0x8d</td>

<td>none</td>

<td>8 byte
<br>current pics - b[2..3] MSB
<br>max pics - b[4..5] MSB</td>

<td>Get (All) Picture Information</td>
</tr>

<tr>
<td>0x8f</td>

<td>picture number</td>

<td>16 byte
<br>size - b[0..3] MSB
<br>width - b[4..5] MSB
<br>height - b[6..7] MSB
<p>untested:
<br>orig gain - b[12]
<br>avg pixval - b[14]
<br>fineexp - b[8..9] MSB
<br>coarse exp - b[10..11] MSB</td>

<td>Get Picture Information</td>
</tr>

<tr>
<td>0x92</td>

<td>?</td>

<td>16 byte</td>

<td>Get Exposure Packet?
<br>(doesn't work for me)</td>
</tr>

<tr>
<td>0x93</td>

<td>?</td>

<td>2 byte
<br>0 - sensor capabilities
<br>1 - sensor rate</td>

<td>Get Sensor Info</td>
</tr>

<tr>
<td>0x94</td>

<td>none</td>

<td>2 byte
<br>b[0] - camera woke system.</td>

<td>Woke System?</td>
</tr>
</table>

</body>
</html>
